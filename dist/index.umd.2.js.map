{"version":3,"sources":["webpack://index/./src/components/el-upload.vue?2791","webpack://index/src/components/el-upload.vue","webpack://index/./src/components/el-upload.vue?d3be","webpack://index/./src/components/el-upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,0BAA0B,aAAa,0BAA0B,wBAAwB,uBAAuB,OAAO,iTAAiT,YAAY,OAAO,oBAAoB,8BAA8B,wBAAwB,OAAO,yDAAyD,sBAAsB;AAC3lB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACyBA;;AAE8C;AACA;;AAE9C;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oBAAoB,8BAAe;;AAE5B;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEe;AACf;AACA;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA,eAAe,8BAAe;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,yCAAU;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,EAAC;;;ACjPgL,CAAgB,kHAAG,EAAC,C;;;;;ACAlG;AACvC;AACL;;;AAGxD;AAC0F;AAC1F,gBAAgB,8CAAU;AAC1B,EAAE,4CAAM;AACR,EAAE,MAAM;AACR,EAAE,eAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEe,gG","file":"index.umd.2.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('el-upload',{attrs:{\"action\":\"\",\"show-file-list\":_vm.showFileList,\"accept\":_vm.actualAccept,\"data\":_vm.data,\"list-type\":_vm.listType,\"file-list\":_vm.fileList,\"before-upload\":_vm.handleBeforeUpload,\"http-request\":_vm.customUpload,\"disabled\":_vm.disabled,\"multiple\":_vm.multiple,\"limit\":_vm.limit,\"on-exceed\":_vm.handleExceed}},[_c('div',{attrs:{\"id\":_vm.triggerId}},[_vm._t(\"default\",function(){return [_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"primary\",\"disabled\":_vm.disabled}},[_vm._v(\" 点击上传 \")])]})],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <el-upload\r\n    action=\"\"\r\n    :show-file-list=\"showFileList\"\r\n    :accept=\"actualAccept\"\r\n    :data=\"data\"\r\n    :list-type=\"listType\"\r\n    :file-list=\"fileList\"\r\n    :before-upload=\"handleBeforeUpload\"\r\n    :http-request=\"customUpload\"\r\n    :disabled=\"disabled\"\r\n    :multiple=\"multiple\"\r\n    :limit=\"limit\"\r\n    :on-exceed=\"handleExceed\"\r\n  >\r\n    <div :id=\"triggerId\">\r\n      <slot>\r\n        <el-button size=\"small\" type=\"primary\" :disabled=\"disabled\">\r\n          点击上传\r\n        </el-button>\r\n      </slot>\r\n    </div>\r\n  </el-upload>\r\n</template>\r\n\r\n<script>\r\n// TODO 图片剪裁 https://github.com/dai-siki/vue-image-crop-upload/blob/master/upload-2.vue\r\n\r\nimport { uploaderDefault } from \"../index.js\";\r\nimport { fixImgFile } from \"ios-photo-repair\";\r\n\r\n/**\r\n * 提取文件名中的扩展名\r\n * @param filename[String] 要提取扩展名的字符串\r\n * @return 转小写后的扩展名字符串\r\n */\r\nexport const getSuffix = (filename) => {\r\n  let pos = filename.lastIndexOf(\".\");\r\n  let suffix = \"\";\r\n  if (pos != -1) {\r\n    suffix = filename.substring(pos + 1);\r\n  }\r\n  return suffix.toLowerCase();\r\n};\r\n\r\n/**\r\n * 通过文件类型获取扩展名列表\r\n * @param type[String] FileTypeMap 中约定的类型名\r\n * @return 目标类型的扩展名数组\r\n * */\r\nconst FileTypeMap = uploaderDefault.FileTypeMap || {};\r\n\r\nexport const getExtByType = (type) => {\r\n  if (type && Array.isArray(FileTypeMap[type])) {\r\n    let classList = [];\r\n    let extList = [];\r\n    FileTypeMap[type].forEach((e) => {\r\n      if (e.indexOf(\"t-\") === 0) {\r\n        classList.push(e);\r\n      } else {\r\n        extList.push(e);\r\n      }\r\n    });\r\n    if (classList.length) {\r\n      classList.forEach((classType) => {\r\n        extList = extList.concat(getExtByType(classType));\r\n      });\r\n    }\r\n    return extList;\r\n  } else if (type && type.split) {\r\n    return [type.toLowerCase()];\r\n  }\r\n};\r\n\r\nexport default {\r\n  name: \"Uploader\",\r\n  props: {\r\n    multiple: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: uploaderDefault.multiple,\r\n    },\r\n    data: {\r\n      type: Object,\r\n      required: false,\r\n      default: uploaderDefault.data,\r\n    },\r\n    name: {\r\n      type: String,\r\n      required: false,\r\n      default: uploaderDefault.name,\r\n    },\r\n    showFileList: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: uploaderDefault.showFileList,\r\n    },\r\n    accept: {\r\n      type: String,\r\n      required: false,\r\n      default: uploaderDefault.accept,\r\n    },\r\n    listType: {\r\n      type: String,\r\n      required: false,\r\n      default: uploaderDefault.listType,\r\n    },\r\n    fileList: {\r\n      type: Array,\r\n      required: false,\r\n      default: uploaderDefault.fileList,\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: uploaderDefault.disabled,\r\n    },\r\n    limit: {\r\n      type: Number,\r\n      required: false,\r\n      default: uploaderDefault.limit,\r\n    },\r\n    beforeUpload: {\r\n      type: Function,\r\n      required: false,\r\n      default: uploaderDefault.beforeUpload,\r\n    },\r\n    triggerId: {\r\n      type: String,\r\n      required: false,\r\n      default: \"upload_image_trigger\" + parseInt(Math.random() * 1e8),\r\n    },\r\n    imgCompress: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: uploaderDefault.imgCompress,\r\n    },\r\n    imgCompressOption: {\r\n      type: Object,\r\n      required: false,\r\n      default: uploaderDefault.imgCompressOption,\r\n    },\r\n    uploadFunc: {\r\n      type: Function,\r\n      required: false,\r\n      default: uploaderDefault.uploadFunc,\r\n    },\r\n    uploadBase64Func: {\r\n      type: Function,\r\n      required: false,\r\n      default: uploaderDefault.uploadBase64Func,\r\n    },\r\n    limitSize: {\r\n      type: Number,\r\n      required: false,\r\n      default: uploaderDefault.limitSize,\r\n    },\r\n  },\r\n  computed: {\r\n    actualAccept() {\r\n      if (this.accept.indexOf(\"t-\") !== -1) {\r\n        const typeArray = this.accept.split(\",\");\r\n        let result = [];\r\n        typeArray.forEach((type) => {\r\n          result = result.concat(getExtByType(type));\r\n        });\r\n        return result.join(\",\");\r\n      } else {\r\n        return this.accept;\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    handleExceed() {\r\n      this.$emit(\"exceed\");\r\n    },\r\n    handleSuccess: function (res) {\r\n      this.$emit(\"success\", res.data);\r\n    },\r\n    handleError: function (err) {\r\n      this.$emit(\"error\", err);\r\n    },\r\n    handleBeforeUpload: function (file) {\r\n      // 格式检查\r\n      const fileExt = getSuffix(file.name);\r\n      const extWhite = this.actualAccept.replace(/\\./g, \"\").split(\",\");\r\n      if (extWhite.findIndex((ext) => ext === \"*\" || ext === fileExt) === -1) {\r\n        this.$message.warning(\"文件格式错误\");\r\n        return false;\r\n      }\r\n      // 尺寸校验\r\n      if (file.size > this.limitSize) {\r\n        this.$message.warning(\"文件超出最大限制\");\r\n        return false;\r\n      }\r\n      // 文件名不得超过500字符\r\n      if (file.name.length > 500) {\r\n        this.$message.warning(\"文件名不得超过500字符\");\r\n        return false;\r\n      }\r\n      // 扩展校验方法\r\n      return this.beforeUpload(file);\r\n    },\r\n    customUpload: function (params) {\r\n      if (this.imgCompress && params.file.type.indexOf(\"image/\") === 0) {\r\n        // 图片自动压缩\r\n        fixImgFile(params.file, this.imgCompressOption).then((base64) => {\r\n          const name = params.file.name.replace(/\\.[^.]+\\w+$/, \".png\");\r\n          if (base64 && name) {\r\n            this.uploadBase64Func({\r\n              base64,\r\n              name,\r\n            })\r\n              .then((res) => {\r\n                this.handleSuccess(res.data);\r\n              })\r\n              .catch((err) => {\r\n                this.handleError(err);\r\n              });\r\n          } else {\r\n            console.warn(\"图片压缩error\", base64, name);\r\n          }\r\n        });\r\n      } else {\r\n        // 非图片上传\r\n        let formData = new FormData();\r\n        formData.append(this.name, params.file);\r\n        // 扩展数据\r\n        Object.keys(this.data).forEach((key) => {\r\n          formData.append(key, this.data[key]);\r\n        });\r\n        this.uploadFunc(formData)\r\n          .then((res) => {\r\n            this.handleSuccess(res.data);\r\n          })\r\n          .catch((err) => {\r\n            this.handleError(err);\r\n          });\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./el-upload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./el-upload.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./el-upload.vue?vue&type=template&id=020cd7e6&scoped=true&\"\nimport script from \"./el-upload.vue?vue&type=script&lang=js&\"\nexport * from \"./el-upload.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"020cd7e6\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}
{"version":3,"sources":["webpack://index/./src/components/el-upload.vue?2791","webpack://index/src/components/el-upload.vue","webpack://index/./src/components/el-upload.vue?d3be","webpack://index/./src/components/el-upload.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","showFileList","actualAccept","data","listType","fileList","handleBeforeUpload","customUpload","disabled","multiple","limit","handleExceed","triggerId","_t","_v","staticRenderFns","getSuffix","filename","pos","lastIndexOf","suffix","substring","toLowerCase","FileTypeMap","getExtByType","type","Array","isArray","classList","extList","forEach","e","indexOf","push","length","classType","concat","split","name","props","Boolean","required","default","Object","String","accept","Number","beforeUpload","Function","parseInt","Math","random","imgCompress","imgCompressOption","uploadFunc","uploadBase64Func","limitSize","computed","typeArray","result","join","methods","$emit","handleSuccess","res","handleError","err","file","fileExt","extWhite","replace","findIndex","ext","$message","warning","size","params","then","base64","catch","console","warn","formData","FormData","append","keys","key","component"],"mappings":"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","file":"index.umd.min.2.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('el-upload',{attrs:{\"action\":\"\",\"show-file-list\":_vm.showFileList,\"accept\":_vm.actualAccept,\"data\":_vm.data,\"list-type\":_vm.listType,\"file-list\":_vm.fileList,\"before-upload\":_vm.handleBeforeUpload,\"http-request\":_vm.customUpload,\"disabled\":_vm.disabled,\"multiple\":_vm.multiple,\"limit\":_vm.limit,\"on-exceed\":_vm.handleExceed}},[_c('div',{attrs:{\"id\":_vm.triggerId}},[_vm._t(\"default\",function(){return [_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"primary\",\"disabled\":_vm.disabled}},[_vm._v(\" 点击上传 \")])]})],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <el-upload\r\n    action=\"\"\r\n    :show-file-list=\"showFileList\"\r\n    :accept=\"actualAccept\"\r\n    :data=\"data\"\r\n    :list-type=\"listType\"\r\n    :file-list=\"fileList\"\r\n    :before-upload=\"handleBeforeUpload\"\r\n    :http-request=\"customUpload\"\r\n    :disabled=\"disabled\"\r\n    :multiple=\"multiple\"\r\n    :limit=\"limit\"\r\n    :on-exceed=\"handleExceed\"\r\n  >\r\n    <div :id=\"triggerId\">\r\n      <slot>\r\n        <el-button size=\"small\" type=\"primary\" :disabled=\"disabled\">\r\n          点击上传\r\n        </el-button>\r\n      </slot>\r\n    </div>\r\n  </el-upload>\r\n</template>\r\n\r\n<script>\r\n// TODO 图片剪裁 https://github.com/dai-siki/vue-image-crop-upload/blob/master/upload-2.vue\r\n\r\nimport { uploaderDefault } from \"../index.js\";\r\nimport { fixImgFile } from \"ios-photo-repair\";\r\n\r\n/**\r\n * 提取文件名中的扩展名\r\n * @param filename[String] 要提取扩展名的字符串\r\n * @return 转小写后的扩展名字符串\r\n */\r\nexport const getSuffix = (filename) => {\r\n  let pos = filename.lastIndexOf(\".\");\r\n  let suffix = \"\";\r\n  if (pos != -1) {\r\n    suffix = filename.substring(pos + 1);\r\n  }\r\n  return suffix.toLowerCase();\r\n};\r\n\r\n/**\r\n * 通过文件类型获取扩展名列表\r\n * @param type[String] FileTypeMap 中约定的类型名\r\n * @return 目标类型的扩展名数组\r\n * */\r\nconst FileTypeMap = uploaderDefault.FileTypeMap || {};\r\n\r\nexport const getExtByType = (type) => {\r\n  if (type && Array.isArray(FileTypeMap[type])) {\r\n    let classList = [];\r\n    let extList = [];\r\n    FileTypeMap[type].forEach((e) => {\r\n      if (e.indexOf(\"t-\") === 0) {\r\n        classList.push(e);\r\n      } else {\r\n        extList.push(e);\r\n      }\r\n    });\r\n    if (classList.length) {\r\n      classList.forEach((classType) => {\r\n        extList = extList.concat(getExtByType(classType));\r\n      });\r\n    }\r\n    return extList;\r\n  } else if (type && type.split) {\r\n    return [type.toLowerCase()];\r\n  }\r\n};\r\n\r\nexport default {\r\n  name: \"Uploader\",\r\n  props: {\r\n    multiple: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: uploaderDefault.multiple,\r\n    },\r\n    data: {\r\n      type: Object,\r\n      required: false,\r\n      default: uploaderDefault.data,\r\n    },\r\n    name: {\r\n      type: String,\r\n      required: false,\r\n      default: uploaderDefault.name,\r\n    },\r\n    showFileList: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: uploaderDefault.showFileList,\r\n    },\r\n    accept: {\r\n      type: String,\r\n      required: false,\r\n      default: uploaderDefault.accept,\r\n    },\r\n    listType: {\r\n      type: String,\r\n      required: false,\r\n      default: uploaderDefault.listType,\r\n    },\r\n    fileList: {\r\n      type: Array,\r\n      required: false,\r\n      default: uploaderDefault.fileList,\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: uploaderDefault.disabled,\r\n    },\r\n    limit: {\r\n      type: Number,\r\n      required: false,\r\n      default: uploaderDefault.limit,\r\n    },\r\n    beforeUpload: {\r\n      type: Function,\r\n      required: false,\r\n      default: uploaderDefault.beforeUpload,\r\n    },\r\n    triggerId: {\r\n      type: String,\r\n      required: false,\r\n      default: \"upload_image_trigger\" + parseInt(Math.random() * 1e8),\r\n    },\r\n    imgCompress: {\r\n      type: Boolean,\r\n      required: false,\r\n      default: uploaderDefault.imgCompress,\r\n    },\r\n    imgCompressOption: {\r\n      type: Object,\r\n      required: false,\r\n      default: uploaderDefault.imgCompressOption,\r\n    },\r\n    uploadFunc: {\r\n      type: Function,\r\n      required: false,\r\n      default: uploaderDefault.uploadFunc,\r\n    },\r\n    uploadBase64Func: {\r\n      type: Function,\r\n      required: false,\r\n      default: uploaderDefault.uploadBase64Func,\r\n    },\r\n    limitSize: {\r\n      type: Number,\r\n      required: false,\r\n      default: uploaderDefault.limitSize,\r\n    },\r\n  },\r\n  computed: {\r\n    actualAccept() {\r\n      if (this.accept.indexOf(\"t-\") !== -1) {\r\n        const typeArray = this.accept.split(\",\");\r\n        let result = [];\r\n        typeArray.forEach((type) => {\r\n          result = result.concat(getExtByType(type));\r\n        });\r\n        return result.join(\",\");\r\n      } else {\r\n        return this.accept;\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    handleExceed() {\r\n      this.$emit(\"exceed\");\r\n    },\r\n    handleSuccess: function (res) {\r\n      this.$emit(\"success\", res.data);\r\n    },\r\n    handleError: function (err) {\r\n      this.$emit(\"error\", err);\r\n    },\r\n    handleBeforeUpload: function (file) {\r\n      // 格式检查\r\n      const fileExt = getSuffix(file.name);\r\n      const extWhite = this.actualAccept.replace(/\\./g, \"\").split(\",\");\r\n      if (extWhite.findIndex((ext) => ext === \"*\" || ext === fileExt) === -1) {\r\n        this.$message.warning(\"文件格式错误\");\r\n        return false;\r\n      }\r\n      // 尺寸校验\r\n      if (file.size > this.limitSize) {\r\n        this.$message.warning(\"文件超出最大限制\");\r\n        return false;\r\n      }\r\n      // 文件名不得超过500字符\r\n      if (file.name.length > 500) {\r\n        this.$message.warning(\"文件名不得超过500字符\");\r\n        return false;\r\n      }\r\n      // 扩展校验方法\r\n      return this.beforeUpload(file);\r\n    },\r\n    customUpload: function (params) {\r\n      if (this.imgCompress && params.file.type.indexOf(\"image/\") === 0) {\r\n        // 图片自动压缩\r\n        fixImgFile(params.file, this.imgCompressOption).then((base64) => {\r\n          const name = params.file.name.replace(/\\.[^.]+\\w+$/, \".png\");\r\n          if (base64 && name) {\r\n            this.uploadBase64Func({\r\n              base64,\r\n              name,\r\n            })\r\n              .then((res) => {\r\n                this.handleSuccess(res.data);\r\n              })\r\n              .catch((err) => {\r\n                this.handleError(err);\r\n              });\r\n          } else {\r\n            console.warn(\"图片压缩error\", base64, name);\r\n          }\r\n        });\r\n      } else {\r\n        // 非图片上传\r\n        let formData = new FormData();\r\n        formData.append(this.name, params.file);\r\n        // 扩展数据\r\n        Object.keys(this.data).forEach((key) => {\r\n          formData.append(key, this.data[key]);\r\n        });\r\n        this.uploadFunc(formData)\r\n          .then((res) => {\r\n            this.handleSuccess(res.data);\r\n          })\r\n          .catch((err) => {\r\n            this.handleError(err);\r\n          });\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./el-upload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./el-upload.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./el-upload.vue?vue&type=template&id=020cd7e6&scoped=true&\"\nimport script from \"./el-upload.vue?vue&type=script&lang=js&\"\nexport * from \"./el-upload.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"020cd7e6\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}